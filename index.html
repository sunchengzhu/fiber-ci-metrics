<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Fiber Daily Performance Metrics</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            padding: 30px;
            background: #f7f9fb;
            color: #222;
        }
        h1 {
            margin-bottom: 10px;
            font-size: 24px;
        }
        p.subtitle {
            color: #555;
            font-size: 14px;
            font-style: italic;
            margin-top: 0;
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 8px 10px;
            text-align: center;
        }
        th {
            background: #f2f4f6;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #fafafa;
        }
        td:last-child {
            font-weight: 600;
        }
        td.positive {
            color: #008a2e;
        }
        td.negative {
            color: #d43c3c;
        }
    </style>
</head>
<body>
<h1>ðŸ§µ Fiber Daily Performance Metrics</h1>
<p class="subtitle">
    <strong>TPS</strong> represents the best throughput (transactions per second) achieved during the benchmark,
    while <strong>Threads</strong> indicates the number of concurrent threads used to reach that TPS.
</p>

<table id="data-table">
    <thead>
    <tr>
        <th>Date</th>
        <th>Test End Time (UTC+8)</th>
        <th>FNN Version</th>
        <th>Attempt</th>
        <th>Threads</th>
        <th>TPS</th>
        <th>% Change</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
  async function loadData() {
    const url =
      "https://efjpttqncntihjbnvpdi.supabase.co/rest/v1/ci_metrics" +
      "?select=measured_at,measured_date,attempt,threads,tps,pct_change,fnn_version" +
      "&order=measured_at.desc" +
      "&limit=20" +
      "&apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmanB0dHFuY250aWhqYm52cGRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5ODY3NjIsImV4cCI6MjA3NTU2Mjc2Mn0.tgSuUx82oCi19PRvC4DSZ6cz-Uq6-40cmSjrhYbj2yo";

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      const tbody = document.querySelector("#data-table tbody");
      tbody.innerHTML = data
        .map((r) => {
          const dateOnly =
            r.measured_date ||
            new Date(r.measured_at).toISOString().slice(0, 10);
          const timestamp = new Date(r.measured_at).toLocaleString("en-US", {
            timeZone: "Asia/Shanghai",
          });
          const fnnVer = r.fnn_version || "â€”";
          const attempt = r.attempt != null ? r.attempt : "â€”";
          const pct =
            r.pct_change == null
              ? "â€”"
              : (r.pct_change > 0
                ? `<span class='positive'>+${r.pct_change.toFixed(3)}%</span>`
                : `<span class='negative'>${r.pct_change.toFixed(3)}%</span>`);
          return `
            <tr>
              <td>${dateOnly}</td>
              <td>${timestamp}</td>
              <td>${fnnVer}</td>
              <td>${attempt}</td>
              <td>${r.threads}</td>
              <td>${r.tps.toFixed(2)}</td>
              <td>${pct}</td>
            </tr>`;
        })
        .join("");
    } catch (err) {
      document.body.innerHTML += `<p style="color:red">Error: ${err.message}</p>`;
      console.error(err);
    }
  }

  // Initial load + auto refresh every 60s
  loadData();
  setInterval(loadData, 60000);
</script>
</body>
</html>
